<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>USA Weather Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --bg: #000;
      --card-bg: #1c1c1e;
      --header-bg: rgba(20, 20, 22, 0.85);
      --text: #fff;
      --text-secondary: #8e8e93;
      --accent: #0a84ff;
      --separator: #38383a;
      --success: #34c759;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; font-family: -apple-system, system-ui, sans-serif;
      background: var(--bg); color: var(--text); overflow: hidden;
      display: flex; flex-direction: column; height: 100vh;
    }

    header {
      background: var(--header-bg); backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      padding: max(env(safe-area-inset-top), 8px) 16px 8px;
      border-bottom: 0.5px solid var(--separator);
      z-index: 1000; flex-shrink: 0;
    }
    .header-content { display: flex; align-items: center; justify-content: space-between; }
    h1 { margin: 0; font-size: 14px; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; }
    #lastUpdated { font-size: 10px; color: var(--text-secondary); font-weight: 600; margin-top: 2px; }

    main {
      flex: 1; display: flex; position: relative; overflow: hidden;
    }

    #map { flex: 1; background: #000; }

    .side-stats {
      width: 180px; background: var(--card-bg); border-left: 0.5px solid var(--separator);
      display: flex; flex-direction: column; gap: 12px; padding: 16px; overflow-y: auto;
      z-index: 500;
    }
    .side-title { font-size: 10px; font-weight: 800; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
    .state-card {
      background: rgba(255,255,255,0.05); border-radius: 12px; padding: 10px;
      border: 0.5px solid var(--separator); display: flex; flex-direction: column; gap: 4px;
    }
    .state-name { font-size: 12px; font-weight: 700; color: var(--accent); }
    .state-temp { font-size: 18px; font-weight: 900; }
    .state-desc { font-size: 9px; color: var(--text-secondary); text-transform: capitalize; }

    .temp-marker {
      background: white; border: 1.5px solid #000; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      transition: transform 0.2s;
    }
    .temp-marker:hover { transform: scale(1.2); z-index: 1000 !important; }

    #loadingOverlay {
      position: fixed; inset: 0; background: #000; z-index: 9999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 15px; font-weight: 700; color: var(--accent);
    }

    @media (max-width: 600px) {
      .side-stats { width: 120px; padding: 10px; }
      .state-temp { font-size: 14px; }
    }
  </style>
</head>
<body>

  <div id="loadingOverlay">
    <div style="font-size: 40px; animation: pulse 1.5s infinite">üõ∞Ô∏è</div>
    <div id="loadingText">Syncing Satellite Data...</div>
  </div>

  <header>
    <div class="header-content">
      <div>
        <h1>National Weather Pulse</h1>
        <div id="lastUpdated">Initializing...</div>
      </div>
      <div style="display:flex; gap: 10px">
        <div id="statusDot" style="width: 8px; height: 8px; background: var(--success); border-radius: 50%; margin-top: 4px"></div>
      </div>
    </div>
  </header>

  <main>
    <div id="map"></div>
    <div class="side-stats">
      <div class="side-title">Offshore Stats</div>
      <div id="alaskaCard" class="state-card">
        <span class="state-name">Alaska</span>
        <span class="state-temp" id="akTemp">--¬∞</span>
        <span class="state-desc" id="akDesc">Juneau</span>
      </div>
      <div id="hawaiiCard" class="state-card">
        <span class="state-name">Hawaii</span>
        <span class="state-temp" id="hiTemp">--¬∞</span>
        <span class="state-desc" id="hiDesc">Honolulu</span>
      </div>
      <div style="margin-top: auto">
        <div class="side-title" style="opacity: 0.5">Auto-Refresh</div>
        <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px">Every 5 Minutes</div>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const capitals = [
      { n: "Montgomery", s: "AL", lat: 32.3668, lon: -86.3006 },
      { n: "Juneau", s: "AK", lat: 58.3019, lon: -134.4197 },
      { n: "Phoenix", s: "AZ", lat: 33.4484, lon: -112.0740 },
      { n: "Little Rock", s: "AR", lat: 34.7465, lon: -92.2896 },
      { n: "Sacramento", s: "CA", lat: 38.5816, lon: -121.4944 },
      { n: "Denver", s: "CO", lat: 39.7392, lon: -104.9903 },
      { n: "Hartford", s: "CT", lat: 41.7637, lon: -72.6851 },
      { n: "Dover", s: "DE", lat: 39.1582, lon: -75.5244 },
      { n: "Tallahassee", s: "FL", lat: 30.4383, lon: -84.2807 },
      { n: "Atlanta", s: "GA", lat: 33.7490, lon: -84.3880 },
      { n: "Honolulu", s: "HI", lat: 21.3069, lon: -157.8583 },
      { n: "Boise", s: "ID", lat: 43.6150, lon: -116.2023 },
      { n: "Springfield", s: "IL", lat: 39.7817, lon: -89.6501 },
      { n: "Indianapolis", s: "IN", lat: 39.7684, lon: -86.1581 },
      { n: "Des Moines", s: "IA", lat: 41.5868, lon: -93.6250 },
      { n: "Topeka", s: "KS", lat: 39.0473, lon: -95.6752 },
      { n: "Frankfort", s: "KY", lat: 38.1973, lon: -84.8733 },
      { n: "Baton Rouge", s: "LA", lat: 30.4515, lon: -91.1871 },
      { n: "Augusta", s: "ME", lat: 44.3106, lon: -69.7795 },
      { n: "Annapolis", s: "MD", lat: 38.9784, lon: -76.4922 },
      { n: "Boston", s: "MA", lat: 42.3601, lon: -71.0589 },
      { n: "Lansing", s: "MI", lat: 42.7325, lon: -84.5555 },
      { n: "St. Paul", s: "MN", lat: 44.9442, lon: -93.0933 },
      { n: "Jackson", s: "MS", lat: 32.2988, lon: -90.1848 },
      { n: "Jefferson City", s: "MO", lat: 38.5767, lon: -92.1735 },
      { n: "Helena", s: "MT", lat: 46.5891, lon: -112.0391 },
      { n: "Lincoln", s: "NE", lat: 40.8136, lon: -96.7026 },
      { n: "Carson City", s: "NV", lat: 39.1638, lon: -119.7674 },
      { n: "Concord", s: "NH", lat: 43.2081, lon: -71.5376 },
      { n: "Trenton", s: "NJ", lat: 40.2170, lon: -74.7429 },
      { n: "Santa Fe", s: "NM", lat: 35.6870, lon: -105.9378 },
      { n: "Albany", s: "NY", lat: 42.6526, lon: -73.7562 },
      { n: "Raleigh", s: "NC", lat: 35.7796, lon: -78.6382 },
      { n: "Bismarck", s: "ND", lat: 46.8083, lon: -100.7837 },
      { n: "Columbus", s: "OH", lat: 39.9612, lon: -82.9988 },
      { n: "Oklahoma City", s: "OK", lat: 35.4676, lon: -97.5164 },
      { n: "Salem", s: "OR", lat: 44.9429, lon: -123.0351 },
      { n: "Harrisburg", s: "PA", lat: 40.2732, lon: -76.8867 },
      { n: "Providence", s: "RI", lat: 41.8240, lon: -71.4128 },
      { n: "Columbia", s: "SC", lat: 34.0007, lon: -81.0348 },
      { n: "Pierre", s: "SD", lat: 44.3668, lon: -100.3364 },
      { n: "Nashville", s: "TN", lat: 36.1627, lon: -86.7816 },
      { n: "Austin", s: "TX", lat: 30.2672, lon: -97.7431 },
      { n: "Salt Lake City", s: "UT", lat: 40.7608, lon: -111.8910 },
      { n: "Montpelier", s: "VT", lat: 44.2601, lon: -72.5754 },
      { n: "Richmond", s: "VA", lat: 37.5407, lon: -77.4360 },
      { n: "Olympia", s: "WA", lat: 47.0379, lon: -122.9007 },
      { n: "Charleston", s: "WV", lat: 38.3498, lon: -81.6326 },
      { n: "Madison", s: "WI", lat: 43.0731, lon: -89.4012 },
      { n: "Cheyenne", s: "WY", lat: 41.1400, lon: -104.8202 }
    ];

    const map = L.map('map', {
      zoomControl: false,
      attributionControl: false,
      maxBounds: [[20, -130], [55, -60]]
    }).setView([39.8283, -98.5795], 4);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const markersGroup = L.layerGroup().addTo(map);

    function getTColor(t) {
      const minTemp = 32, maxTemp = 95;
      const ratio = Math.max(0, Math.min(1, (t - minTemp) / (maxTemp - minTemp)));
      const r = Math.round(255 * ratio);
      const b = Math.round(255 * (1 - ratio));
      const g = Math.round(150 * (1 - Math.abs(ratio - 0.5) * 2));
      return `rgb(${r},${g},${b})`;
    }

    async function updateWeather() {
      document.getElementById('statusDot').style.background = '#ff9500';
      
      const latList = capitals.map(c => c.lat).join(',');
      const lonList = capitals.map(c => c.lon).join(',');
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${latList}&longitude=${lonList}&current_weather=true&temperature_unit=fahrenheit&windspeed_unit=mph&precipitation_unit=inch&timezone=auto`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const weatherArray = Array.isArray(data) ? data : [data]; // Handle multi-location response format

        markersGroup.clearLayers();

        capitals.forEach((cap, i) => {
          const w = data[i].current_weather;
          const color = getTColor(w.temperature);
          const temp = Math.round(w.temperature);

          if (cap.s === 'AK') {
            document.getElementById('akTemp').innerText = `${temp}¬∞`;
            return;
          }
          if (cap.s === 'HI') {
            document.getElementById('hiTemp').innerText = `${temp}¬∞`;
            return;
          }

          const icon = L.divIcon({
            className: 'custom-icon',
            html: `<div class="temp-marker" style="background:${color}; color:${temp > 75 || temp < 40 ? '#fff' : '#000'}">${temp}</div>`,
            iconSize: [24, 24],
            iconAnchor: [12, 12]
          });

          L.marker([cap.lat, cap.lon], { icon }).addTo(markersGroup)
            .bindPopup(`<b>${cap.n}, ${cap.s}</b><br>Temp: ${temp}¬∞F<br>Wind: ${w.windspeed} mph`);
        });

        const now = new Date();
        document.getElementById('lastUpdated').innerText = `Last Updated: ${now.toLocaleTimeString()}`;
        document.getElementById('statusDot').style.background = 'var(--success)';
        document.getElementById('loadingOverlay').style.display = 'none';

      } catch (err) {
        console.error(err);
        document.getElementById('statusDot').style.background = '#ff3b30';
      }
    }

    // Initial load
    updateWeather();

    // 5-minute refresh
    setInterval(updateWeather, 5 * 60 * 1000);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pi Weather + Clock Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }
body {
  margin:0;
  background:black;
  color:white;
  font-family:Arial, Helvetica, sans-serif;
  height:100vh;
  display:grid;
  grid-template-rows:auto 1fr auto auto;
  overflow:hidden; /* NO SCROLL */
  transition: background 0.3s ease;
}
.center { display:flex; justify-content:center; align-items:center; }

/* CLOCK */
#clock { font-size:8vw; font-weight:bold; }
body.pulse #clock { font-size:15vw; }

/* CALENDAR */
#calendar { padding:2vh 4vw; font-size:1.5vw; }

/* CURRENT WEATHER */
#weather { text-align:center; font-size:2vw; padding-bottom:1vh; }

/* FORECAST */
#forecast { padding:1vh 2vw; font-size:1.6vw; display:flex; flex-wrap:wrap; justify-content:center; align-items:center; overflow:hidden; }

/* FORECAST TILE */
.forecast-tile {
  background:#111;
  margin:0.5vw;
  padding:1vh 1vw;
  min-width:12vw;
  flex:0 0 auto;
  border-radius:0.5vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  transition:transform 0.5s ease;
}
.forecast-tile img { width:3vw; height:3vw; margin-bottom:0.5vh; }

/* RESPONSIVE */
@media (max-width:1024px){
  #clock{font-size:14vw;}
  body.pulse #clock{font-size:22vw;}
  #weather{font-size:3.5vw;}
  #forecast{font-size:3vw;}
  .forecast-tile img{width:6vw;height:6vw;}
}
</style>
</head>

<body>

<div class="center"><div id="clock">--:--:--</div></div>
<div id="calendar"></div>
<div id="weather">Loading weather‚Ä¶</div>
<div id="forecast">Loading forecast‚Ä¶</div>

<script>
/* ===================== CONFIG ===================== */
const CONFIG = {
  location:{lat:39.5186,lon:-104.7614}, // Parker, CO
  refreshMs:30*60*1000, // 30 minutes
  rotateIntervalMs:5000 // rotate forecast tiles every 5s if needed
};

/* ===================== CLOCK ===================== */
function updateClock(){
  const now = new Date();
  const timeString = now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  document.getElementById("clock").textContent = timeString;
  if(now.getSeconds()===0){
    document.body.classList.add("pulse");
    setTimeout(()=>document.body.classList.remove("pulse"),1000);
  }
}
setInterval(updateClock,1000);
updateClock();

/* ===================== CALENDAR ===================== */
function renderCalendar(){
  const now = new Date();
  const year = now.getFullYear(), month = now.getMonth(), today = now.getDate();
  const monthName = now.toLocaleString("default",{month:"long"});
  const firstDay = new Date(year,month,1).getDay();
  const daysInMonth = new Date(year,month+1,0).getDate();

  let html=`<div style="text-align:center; font-size:2vw">${monthName} ${year}</div><div style="display:grid;grid-template-columns:repeat(7,1fr);gap:0.3vh">`;
  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>html+=`<div style="opacity:0.6">${d}</div>`);
  for(let i=0;i<firstDay;i++) html+="<div></div>";
  for(let d=1;d<=daysInMonth;d++){
    const cls=d===today?"background:white;color:black;font-weight:bold;":"";
    html+=`<div style="padding:0.5vh 0; ${cls}">${d}</div>`;
  }
  html+="</div>";
  document.getElementById("calendar").innerHTML=html;
}
renderCalendar();

/* ===================== CURRENT WEATHER ===================== */
async function loadCurrentWeather(){
  try{
    const {lat,lon}=CONFIG.location;
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`+
              `&current_weather=true&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch`;
    const res=await fetch(url); const data=await res.json();
    const w=data.current_weather;
    document.getElementById("weather").textContent=`Now: üå°Ô∏è ${Math.round(w.temperature)}¬∞F üí® ${Math.round(w.windspeed)} mph`;
  }catch{document.getElementById("weather").textContent="Current weather unavailable";}
}
loadCurrentWeather();
setInterval(loadCurrentWeather,CONFIG.refreshMs);

/* ===================== 7 DAY FORECAST ===================== */
let forecastData=[]; let forecastIndex=0;
async function loadForecast(){
  try{
    const {lat,lon}=CONFIG.location;
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`+
      `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,rain_sum,snowfall_sum,windspeed_10m_max,precipitation_probability_max,sunrise,sunset,weathercode`+
      `&timezone=auto&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch`;
    const res=await fetch(url); const d=await res.json();
    forecastData=d.daily;
    renderForecast(); // initial render
  }catch{document.getElementById("forecast").textContent="Forecast unavailable";}
}
loadForecast();
setInterval(loadForecast,CONFIG.refreshMs);

/* ===================== FORECAST ICONS ===================== */
function getWeatherIcon(code){
  // basic mapping: 0=clear, 1-3=cloudy, 61-63=rain, 71-73=snow, others=cloud
  if(code===0) return "‚òÄÔ∏è";
  else if(code<=3) return "‚õÖ";
  else if(code>=61 && code<=63) return "üåßÔ∏è";
  else if(code>=71 && code<=73) return "‚ùÑÔ∏è";
  else return "‚òÅÔ∏è";
}

/* ===================== RENDER FORECAST ===================== */
function renderForecast(){
  const container=document.getElementById("forecast");
  container.innerHTML=""; // clear
  forecastData.time.forEach((t,i)=>{
    const date=new Date(t); const dayName=date.toLocaleDateString([], {weekday:'short'});
    const hi=Math.round(forecastData.temperature_2m_max[i]);
    const lo=Math.round(forecastData.temperature_2m_min[i]);
    const rain=forecastData.rain_sum[i].toFixed(2);
    const snow=forecastData.snowfall_sum[i].toFixed(2);
    const wind=Math.round(forecastData.windspeed_10m_max[i]);
    const pop=forecastData.precipitation_probability_max[i];
    const sunrise=new Date(forecastData.sunrise[i]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const sunset=new Date(forecastData.sunset[i]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const icon=getWeatherIcon(forecastData.weathercode[i]);

    const tile=document.createElement("div");
    tile.className="forecast-tile";
    tile.innerHTML=`<div>${dayName}</div><div>${icon}</div><div>üå°Ô∏è ${hi}/${lo}¬∞F</div><div>üåßÔ∏è ${rain}</div><div>‚ùÑÔ∏è ${snow}</div><div>üí® ${wind} mph</div><div>‚òî ${pop}%</div><div>üåÖ ${sunrise}</div><div>üåá ${sunset}</div>`;
    container.appendChild(tile);
  });

  // =====================
  // Optional: rotate forecast tiles if they overflow screen
  // =====================
  // TODO: implement rotating tiles every CONFIG.rotateIntervalMs
  // Comment added so we remember for later expansion
}
</script>

</body>
</html>
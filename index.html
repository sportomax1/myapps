<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tile Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;}
body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial,Helvetica,sans-serif;
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* GLOBAL ROTATION TIMER */
#globalTimer{
  width:100%;
  height:0.5vh;
  background:#222;
  position:relative;
}
#globalTimerFill{
  background:#0f0;
  height:100%;
  width:0%;
  transition:width 0.1s linear;
}

/* MAIN GRID */
#mainGrid{
  flex:1;
  display:grid;
  grid-template-rows:1fr 1fr;
  grid-template-columns:repeat(4,1fr);
  gap:1vh;
  padding:1vh;
}

/* TILE STYLE */
.tile{
  background:#111;
  border-radius:1vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1vh;
  overflow:hidden;
  position:relative;
}

/* CLOCK */
#clock{font-size:4vw;font-weight:bold;text-align:center;}
#militaryTime{font-size:1vw;margin-top:0.3vh;opacity:0.7;}
#sunTimes{font-size:1vw;margin-top:0.3vh;opacity:0.8;}
#currentWeather{font-size:0.9vw;margin-top:0.3vh;opacity:0.85;text-align:center;}
#moonPhase{font-size:1.5vw;margin-top:0.3vh;opacity:0.9;text-align:center;}
#moonDates{font-size:0.8vw;margin-top:0.2vh;opacity:0.7;text-align:center;}
#tileClock.pulse{border:0.3vh solid white;transition:border 0.3s;}

/* INTERNET SPEED */
#speed{font-size:1.2vw;text-align:center;}

/* CALENDAR */
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:0.3vh;width:90%;}
.calendar-day{opacity:0.6;font-weight:bold;text-align:center;}
.calendar-date{padding:0.5vh 0;border-radius:50%;display:flex;justify-content:center;align-items:center;}
.today{background:white;color:black;font-weight:bold;}
#holidayCountdown{font-size:0.9vw;margin-top:0.5vh;text-align:center;width:90%;}

/* FORECAST */
#forecast{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:0.3vh;}
.forecast-day{background:#222;margin:0.3vh;padding:0.5vh 0.5vw;width:90%;border-radius:0.5vh;text-align:center;}

/* ROTATING TILE SLIDER */
.tile-slider{display:none;}

/* BGG LIST */
#bggList{width:100%;height:100%;overflow:auto;}
#bggGrid{display:grid;grid-template-columns:repeat(5,1fr);gap:0.4vh;width:100%;height:100%;padding:0.5vh;overflow:auto;}
.bgg-card{background:#222;border:1px solid #333;border-radius:0.5vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0.5vh;position:relative;overflow:hidden;aspect-ratio:1/1;}
.bgg-rank{position:absolute;top:0.2vh;left:0.2vh;background:#000;color:#fff;font-weight:bold;font-size:0.6vw;padding:0.2vh 0.3vh;border-radius:0.2vh;z-index:10;}
.bgg-card img{width:80%;height:80%;object-fit:cover;margin-bottom:0.3vh;border-radius:0.3vh;}
.bgg-info{font-size:0.5vw;text-align:center;color:#ccc;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;width:100%;}

/* SPORTS TEAM SCHEDULE */
#sportsContent{display:flex;flex-direction:column;width:95%;height:95%;overflow:hidden;font-size:0.7vw;text-align:left;}
.sports-team-header{display:flex;align-items:center;gap:0.5vw;margin-bottom:0.8vh;border-bottom:1px solid #333;padding-bottom:0.5vh;}
.sports-team-icon{font-size:1.5vw;}
.sports-team-name{font-weight:bold;color:#fff;flex:1;white-space:nowrap;}
.sports-team-league{font-size:0.6vw;color:#888;text-transform:uppercase;}
.sports-games-container{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:0.5vh;}
.sports-game-card{background:#222;border:1px solid #333;border-radius:0.4vh;padding:0.6vh;display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.4vw;align-items:center;font-size:0.65vw;}
.sports-game-status{font-size:0.55vw;color:#0f0;font-weight:bold;text-transform:uppercase;grid-column:1/-1;text-align:center;margin-bottom:0.3vh;}
.sports-game-final{color:#f80;}
.sports-game-team{display:flex;flex-direction:column;align-items:center;gap:0.2vh;}
.sports-game-logo{width:2vh;height:2vh;object-fit:contain;}
.sports-game-abbr{font-weight:bold;font-size:0.6vw;color:#fff;text-transform:uppercase;}
.sports-game-score{font-size:0.9vw;font-weight:bold;color:#fff;margin-top:0.2vh;}
.sports-game-vs{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.2vh;}
.sports-game-date{font-size:0.55vw;color:#888;}
.sports-game-result{font-size:0.6vw;font-weight:bold;text-transform:uppercase;padding:0.2vh 0.3vw;border-radius:0.2vh;}
.sports-game-win{background:#1a4d1a;color:#0f0;}
.sports-game-loss{background:#4d1a1a;color:#ff4444;}

/* TOP 25 RANKINGS GRID */
#funGrid{display:grid;grid-template-columns:repeat(5,1fr);gap:0.4vh;width:100%;height:100%;padding:0.5vh;overflow:auto;}
.ranking-card{background:#222;border:1px solid #333;border-radius:0.5vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0.5vh;position:relative;overflow:hidden;aspect-ratio:1/1;}
.ranking-rank{position:absolute;top:0.2vh;left:0.2vh;background:#000;color:#fff;font-weight:bold;font-size:0.6vw;padding:0.2vh 0.3vh;border-radius:0.2vh;z-index:10;}
.ranking-card img{width:70%;height:70%;object-fit:contain;margin-bottom:0.3vh;}
.ranking-info{font-size:0.5vw;text-align:center;color:#ccc;}
.ranking-info .team-abbr{font-weight:bold;font-size:0.55vw;color:#fff;}
.ranking-info .team-record{font-size:0.45vw;color:#888;}

/* RESPONSIVE */
@media(max-width:1024px){
  #clock{font-size:8vw;}
  #speed{font-size:2vw;}
}
</style>
</head>
<body>

<!-- Global Rotation Timer -->
<div id="globalTimer"><div id="globalTimerFill"></div></div>

<!-- Main Grid -->
<div id="mainGrid">

<!-- Top row tiles -->
<div class="tile" id="tileClock"><div id="clock">--:--:--</div><div id="militaryTime">--:--</div><div id="sunTimes">üåÖ --:-- | üåá --:--</div><div id="currentWeather">Loading...</div><div id="moonPhase">üåë</div><div id="moonDates">Last: -- | Next: --</div></div>
<div class="tile" id="tileSpeed"><div id="speed">Testing speed...</div><div class="tile-slider"><div class="tile-slider-fill" id="speedSlider"></div></div></div>
<div class="tile" id="tileWeather"><div id="weather">Loading weather‚Ä¶</div><div class="tile-slider"><div class="tile-slider-fill" id="weatherSlider"></div></div></div>
<div class="tile" id="tileForecast"><div id="forecast">Loading forecast‚Ä¶</div><div class="tile-slider"><div class="tile-slider-fill" id="forecastSlider"></div></div></div>

<!-- Bottom row tiles -->
<div class="tile" id="tileCalendar"><div id="holidayCountdown"></div><div id="calendar"></div><div id="upcomingHolidays"></div></div>
<div class="tile" id="tileBGG">
  <div id="bggList"><div id="bggGrid">Loading Top 25...</div></div>
  <div class="tile-slider"><div class="tile-slider-fill" id="bggSlider"></div></div>
</div>
<div class="tile" id="tileFun">
  <div id="funGrid">Loading Top 25...</div>
  <div class="tile-slider"><div class="tile-slider-fill" id="funSlider"></div></div>
</div>
<div class="tile" id="tileSports">
  <div id="sportsContent">Loading teams...</div>
  <div class="tile-slider"><div class="tile-slider-fill" id="sportsSlider"></div></div>
</div>

</div><!-- End mainGrid -->

<script>
/* ========== CONFIG ========== */
const CONFIG={rotateIntervalMs:10000, location:{lat:39.5186,lon:-104.7614}};

// Pause states for rotating tiles
const pauseStates={
  speed:false,
  weather:false,
  forecast:false,
  bgg:false,
  fun:false,
  sports:false
};

// Add click handlers to pause/resume rotations
function setupPauseHandlers(){
  document.getElementById('tileSpeed').addEventListener('click',()=>{
    pauseStates.speed=!pauseStates.speed;
    document.getElementById('tileSpeed').style.opacity=pauseStates.speed?'0.6':'1';
  });
  document.getElementById('tileWeather').addEventListener('click',()=>{
    pauseStates.weather=!pauseStates.weather;
    document.getElementById('tileWeather').style.opacity=pauseStates.weather?'0.6':'1';
  });
  document.getElementById('tileForecast').addEventListener('click',()=>{
    pauseStates.forecast=!pauseStates.forecast;
    document.getElementById('tileForecast').style.opacity=pauseStates.forecast?'0.6':'1';
  });
  document.getElementById('tileBGG').addEventListener('click',()=>{
    pauseStates.bgg=!pauseStates.bgg;
    document.getElementById('tileBGG').style.opacity=pauseStates.bgg?'0.6':'1';
  });
  document.getElementById('tileFun').addEventListener('click',()=>{
    pauseStates.fun=!pauseStates.fun;
    document.getElementById('tileFun').style.opacity=pauseStates.fun?'0.6':'1';
  });
  document.getElementById('tileSports').addEventListener('click',()=>{
    pauseStates.sports=!pauseStates.sports;
    document.getElementById('tileSports').style.opacity=pauseStates.sports?'0.6':'1';
  });
}

setTimeout(setupPauseHandlers,100);

/* ========== CLOCK ========== */
let sunriseTime="--:--";
let sunsetTime="--:--";

function updateClock(){
  const now=new Date();
  document.getElementById("clock").textContent=now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  document.getElementById("militaryTime").textContent=now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',hour12:false});
  document.getElementById("sunTimes").innerHTML=`üåÖ ${sunriseTime} | üåá ${sunsetTime}`;
  if(now.getSeconds()===0){
    document.getElementById("tileClock").classList.add("pulse");
    setTimeout(()=>document.getElementById("tileClock").classList.remove("pulse"),1000);
  }
}
setInterval(updateClock,1000);
updateClock();

/* ========== INTERNET SPEED & STOCKS ========== */
let speedData={download:0,upload:0,lastChecked:null};
let stockData="Loading stocks...";
let gasData="Loading gas prices...";
let mortgageData="Loading mortgage rates...";
let speedIndex=0;
const speedViews=["speed","stocks","gas","mortgage"];

async function testSpeed(){
  try{
    // Download test
    const dlStart=performance.now();
    const dlSize=1000000;
    const dlUrl="https://cors-anywhere.herokuapp.com/https://speed.hetzner.de/1MB.bin";
    const dlRes=await fetch(dlUrl,{method:'GET',cache:'no-cache'});
    await dlRes.blob();
    const dlDuration=(performance.now()-dlStart)/1000;
    speedData.download=((dlSize*8)/dlDuration/1000000).toFixed(1);
    
    // Upload test (simulated with small POST)
    const ulStart=performance.now();
    const ulData=new Blob([new ArrayBuffer(100000)]);
    await fetch("https://httpbin.org/post",{method:'POST',body:ulData}).catch(()=>{});
    const ulDuration=(performance.now()-ulStart)/1000;
    speedData.upload=((100000*8)/ulDuration/1000000).toFixed(1);
    
    speedData.lastChecked=new Date();
  }catch{}
}

async function loadStockData(){
  try{
    const tickers=[{symbol:"SPY",name:"S&P 500"},{symbol:"DIA",name:"Dow"},{symbol:"QQQ",name:"Nasdaq"}];
    stockData="<strong>Market Indices</strong><br>";
    
    for(const {symbol,name} of tickers){
      try{
        const url=`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=1d`;
        const res=await fetch(url);
        const data=await res.json();
        if(data.chart && data.chart.result && data.chart.result[0]){
          const quote=data.chart.result[0].meta;
          const price=quote.regularMarketPrice.toFixed(2);
          const prevClose=quote.chartPreviousClose || quote.previousClose;
          const change=quote.regularMarketPrice-prevClose;
          const changePercent=((change/prevClose)*100).toFixed(2);
          const arrow=change>=0?"üü¢":"üî¥";
          stockData+=`${name}: $${price} ${arrow}${changePercent}%<br>`;
        }else{
          stockData+=`${name}: Loading...<br>`;
        }
      }catch(err){
        console.log(`Error loading ${name}:`,err);
        stockData+=`${name}: Error<br>`;
      }
    }
  }catch{stockData="Stocks unavailable";}
}

async function loadMortgageRates(){
  try{
    // Estimated current rates - real implementation would use Freddie Mac API or similar
    const today=new Date();
    mortgageData=`<strong>Mortgage Rates</strong><br>`;
    mortgageData+="üè† 30-Year Fixed: 6.75%<br>";
    mortgageData+="üè† 15-Year Fixed: 6.25%<br>";
    mortgageData+="üè† 5/1 ARM: 6.50%<br>";
    mortgageData+=`<small>Est. ${today.toLocaleDateString([],{month:'short',day:'numeric'})}</small>`;
  }catch{
    mortgageData="Rates unavailable";
  }
}

async function loadGasPrices(){
  try{
    // Using GasBuddy-style data - simplified version
    // Real implementation would need API key or scraping
    const zip="80134";
    gasData=`<strong>Gas Prices (${zip})</strong><br>`;
    gasData+="‚õΩ Regular: $3.25<br>";
    gasData+="‚õΩ Mid-Grade: $3.45<br>";
    gasData+="‚õΩ Premium: $3.65<br>";
    gasData+="<small>Estimated prices</small>";
  }catch{
    gasData="Gas prices unavailable";
  }
}

function rotateSpeedTile(){
  if(pauseStates.speed) return;
  const speedDiv=document.getElementById("speed");
  if(speedViews[speedIndex]==="speed"){
    const time=speedData.lastChecked?speedData.lastChecked.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):"--:--";
    speedDiv.innerHTML=`<strong>Internet Speed</strong><br>‚¨á ${speedData.download} Mbps<br>‚¨Ü ${speedData.upload} Mbps<br><small>Last: ${time}</small>`;
  }else if(speedViews[speedIndex]==="stocks"){
    speedDiv.innerHTML=stockData;
  }else if(speedViews[speedIndex]==="gas"){
    speedDiv.innerHTML=gasData;
  }else if(speedViews[speedIndex]==="mortgage"){
    speedDiv.innerHTML=mortgageData;
  }
  speedIndex=(speedIndex+1)%speedViews.length;
  startTileSlider("speedSlider",CONFIG.rotateIntervalMs);
}

testSpeed();
loadStockData();
loadGasPrices();
loadMortgageRates();
rotateSpeedTile();
setInterval(rotateSpeedTile,CONFIG.rotateIntervalMs);
setInterval(testSpeed,5*60*1000);
setInterval(loadStockData,5*60*1000);
setInterval(loadGasPrices,10*60*1000);
setInterval(loadMortgageRates,10*60*1000);

/* ========== CALENDAR ========== */
function renderCalendar(){
  const now=new Date();
  const year=now.getFullYear(), month=now.getMonth(), today=now.getDate();
  const firstDay=new Date(year,month,1).getDay();
  const daysInMonth=new Date(year,month+1,0).getDate();

  let html="";
  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>html+=`<div class="calendar-day">${d}</div>`);
  for(let i=0;i<firstDay;i++) html+="<div></div>";
  for(let d=1;d<=daysInMonth;d++){
    const cls=d===today?"calendar-date today":"calendar-date";
    html+=`<div class="${cls}">${d}</div>`;
  }
  document.getElementById("calendar").innerHTML=html;
  updateHolidayCountdown();
}

function updateHolidayCountdown(){
  const now=new Date();
  const year=now.getFullYear();
  const holidays=[
    {name:"New Year's",date:new Date(year+1,0,1)},
    {name:"MLK Day",date:getNthWeekday(year,0,1,3)},
    {name:"Presidents'",date:getNthWeekday(year,1,1,3)},
    {name:"Memorial",date:getLastWeekday(year,4,1)},
    {name:"July 4th",date:new Date(year,6,4)},
    {name:"Labor Day",date:getNthWeekday(year,8,1,1)},
    {name:"Veterans",date:new Date(year,10,11)},
    {name:"Thanksgiving",date:getNthWeekday(year,10,4,4)},
    {name:"Christmas",date:new Date(year,11,25)}
  ];
  
  const upcoming=holidays.filter(h=>h.date>now).sort((a,b)=>a.date-b.date);
  if(upcoming.length===0) upcoming.push(holidays[0]);
  
  const startOfYear=new Date(year,0,1);
  const endOfYear=new Date(year,11,31,23,59,59);
  const dayOfYear=Math.ceil((now-startOfYear)/(1000*60*60*24))+1;
  const daysLeftInYear=Math.ceil((endOfYear-now)/(1000*60*60*24));
  
  // Year info above calendar
  document.getElementById("holidayCountdown").innerHTML=`<small>Year ${year}<br>Day ${dayOfYear}<br>${daysLeftInYear} days left</small>`;
  
  // Holidays below calendar
  let holidayHtml="";
  for(let i=0;i<Math.min(5,upcoming.length);i++){
    const days=Math.ceil((upcoming[i].date-now)/(1000*60*60*24));
    const emoji=i===0?"üéâ":i===1?"üéà":i===2?"üéÅ":i===3?"üéä":"üéà";
    holidayHtml+=`${emoji} ${upcoming[i].name}: ${days}d<br>`;
  }
  document.getElementById("upcomingHolidays").innerHTML=holidayHtml;
}

function getNthWeekday(year,month,weekday,n){
  const date=new Date(year,month,1);
  let count=0;
  while(count<n){
    if(date.getDay()===weekday) count++;
    if(count<n) date.setDate(date.getDate()+1);
  }
  return date;
}

function getLastWeekday(year,month,weekday){
  const date=new Date(year,month+1,0);
  while(date.getDay()!==weekday) date.setDate(date.getDate()-1);
  return date;
}

renderCalendar();
setInterval(updateHolidayCountdown,60*60*1000);

/* ========== WEATHER ========== */
let forecastData=[];
const seasonalAvgs={winter:38,spring:58,summer:78,fall:58}; // Colorado averages
let weatherViews=[];
let weatherIndex=0;
let rainHistory=[];
let snowHistory=[];
let uvIndex=0;

async function loadHistoricalPrecipitation(){
  // Parker 80134 coordinates
  const lat=39.5186, lon=-104.7614;
  const today=new Date();
  const endDate=today.toISOString().split('T')[0];
  
  // Start from 3 years ago to ensure we get 10 events
  const startDate=new Date(today);
  startDate.setFullYear(startDate.getFullYear()-3);
  const startDateStr=startDate.toISOString().split('T')[0];
  
  try{
    const url=`https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}`+
      `&start_date=${startDateStr}&end_date=${endDate}`+
      `&daily=rain_sum,snowfall_sum&temperature_unit=fahrenheit&precipitation_unit=inch&timezone=auto`;
    const res=await fetch(url);
    const data=await res.json();
    
    rainHistory=[];
    snowHistory=[];
    
    // Go backwards through time to find last 10 events
    for(let i=data.daily.time.length-1; i>=0 && (rainHistory.length<10 || snowHistory.length<10); i--){
      const rainAmt=data.daily.rain_sum[i];
      const snowAmt=data.daily.snowfall_sum[i];
      const date=new Date(data.daily.time[i]);
      const dateStr=date.toLocaleDateString([],{month:'short',day:'numeric',year:'numeric'});
      
      if(rainAmt>=0.1 && rainHistory.length<10){
        rainHistory.push(`${dateStr}: ${rainAmt.toFixed(2)}"`);
      }
      if(snowAmt>=0.1 && snowHistory.length<10){
        snowHistory.push(`${dateStr}: ${snowAmt.toFixed(2)}"`);
      }
    }
  }catch(e){
    console.log('Error loading historical precipitation:',e);
    rainHistory=['Historical data unavailable'];
    snowHistory=['Historical data unavailable'];
  }
}

async function loadWeather(){
  try{
    // Parker 80134 coordinates
    const lat=39.5186, lon=-104.7614;
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`+
      `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,rain_sum,snowfall_sum,windspeed_10m_max,precipitation_probability_max,sunrise,sunset,weathercode,uv_index_max`+
      `&current_weather=true&timezone=auto&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch`;
    const res=await fetch(url); const d=await res.json();

    // Update sunrise/sunset for clock
    sunriseTime=new Date(d.daily.sunrise[0]).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    sunsetTime=new Date(d.daily.sunset[0]).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});

    // UV Index
    uvIndex=Math.round(d.daily.uv_index_max[0]);
    let uvLevel="Low";
    if(uvIndex>=11) uvLevel="Extreme";
    else if(uvIndex>=8) uvLevel="Very High";
    else if(uvIndex>=6) uvLevel="High";
    else if(uvIndex>=3) uvLevel="Moderate";

    // Current weather for clock tile
    const cw=d.current_weather;
    const todayHi=Math.round(d.daily.temperature_2m_max[0]);
    const todayLo=Math.round(d.daily.temperature_2m_min[0]);
    document.getElementById("currentWeather").innerHTML=`üå°Ô∏è ${todayHi}/${todayLo}¬∞F | üí® ${Math.round(cw.windspeed)} mph | ‚òÄÔ∏è UV: ${uvIndex}`;

    // Calculate historical averages from available data (last 7 days)
    const now=new Date();
    const month=now.getMonth();
    let season="winter";
    if(month>=2 && month<=4) season="spring";
    else if(month>=5 && month<=7) season="summer";
    else if(month>=8 && month<=10) season="fall";
    const avgTemp=seasonalAvgs[season];
    
    // Calculate actual hi/lo from last 7 days of data
    let sumHi=0,sumLo=0,count=0;
    for(let i=0;i<Math.min(7,d.daily.time.length);i++){
      sumHi+=d.daily.temperature_2m_max[i];
      sumLo+=d.daily.temperature_2m_min[i];
      count++;
    }
    const recentAvgHi=count>0?Math.round(sumHi/count):avgTemp+5;
    const recentAvgLo=count>0?Math.round(sumLo/count):avgTemp-5;
    
    // Load historical precipitation data (last 10 actual events)
    await loadHistoricalPrecipitation();
    
    weatherViews=[
      `<strong>Historical Averages (${season})</strong><br>Seasonal: ${avgTemp}¬∞F<br>Recent Hi/Lo: ${recentAvgHi}/${recentAvgLo}¬∞F<br><small>Last 7 days avg</small>`,
      `<strong>Last 10 Rain Events ‚â•0.1"</strong><br>${rainHistory.length>0?rainHistory.join('<br>'):'No events found'}`,
      `<strong>Last 10 Snow Events ‚â•0.1"</strong><br>${snowHistory.length>0?snowHistory.join('<br>'):'No events found'}`
    ];

    forecastData=d.daily;
    renderForecast();
    rotateWeatherTile();
  }catch{document.getElementById("weather").textContent="Weather unavailable";}
}

function rotateWeatherTile(){
  if(pauseStates.weather) return;
  if(weatherViews.length===0) return;
  document.getElementById("weather").innerHTML=weatherViews[weatherIndex];
  weatherIndex=(weatherIndex+1)%weatherViews.length;
  startTileSlider("weatherSlider",CONFIG.rotateIntervalMs);
}

loadWeather();
setInterval(rotateWeatherTile,CONFIG.rotateIntervalMs);
setInterval(loadWeather,30*60*1000);

function getWeatherIcon(code){if(code===0)return"‚òÄÔ∏è";else if(code<=3)return"‚õÖ";else if(code>=61 && code<=63)return"üåßÔ∏è";else if(code>=71 && code<=73)return"‚ùÑÔ∏è";else return"‚òÅÔ∏è";}

let forecastViewIndex=0;
const forecastViews=[3,7]; // 3-day and 7-day views

function renderForecast(){
  if(!forecastData || !forecastData.time) return;
  
  const container=document.getElementById("forecast"); container.innerHTML="";
  const totalDays=forecastViews[forecastViewIndex];
  
  // Find today in the forecast data
  const now=new Date();
  now.setHours(0,0,0,0);
  
  let todayIndex=-1;
  for(let i=0;i<forecastData.time.length;i++){
    const forecastDate=new Date(forecastData.time[i]);
    forecastDate.setHours(0,0,0,0);
    if(forecastDate.getTime()===now.getTime()){
      todayIndex=i;
      break;
    }
  }
  
  // If we didn't find today, default to first item
  if(todayIndex===-1) todayIndex=0;
  
  // Render from today forward
  for(let i=0;i<totalDays && (todayIndex+i)<forecastData.time.length;i++){
    const idx=todayIndex+i;
    const date=new Date(forecastData.time[idx]);
    const forecastDate=new Date(date);
    forecastDate.setHours(0,0,0,0);
    
    let dayLabel;
    if(i===0) dayLabel="Today";
    else if(i===1) dayLabel="Tomorrow";
    else dayLabel=date.toLocaleDateString([], {weekday:'short',month:'short',day:'numeric'});
    
    const hi=Math.round(forecastData.temperature_2m_max[idx]);
    const lo=Math.round(forecastData.temperature_2m_min[idx]);
    const rain=forecastData.rain_sum[idx].toFixed(2);
    const snow=forecastData.snowfall_sum[idx].toFixed(2);
    const wind=Math.round(forecastData.windspeed_10m_max[idx]);
    const pop=forecastData.precipitation_probability_max[idx];
    const icon=getWeatherIcon(forecastData.weathercode[idx]);

    const dayDiv=document.createElement("div"); dayDiv.className="forecast-day";
    dayDiv.innerHTML=`${dayLabel} ${icon} üå°Ô∏è ${hi}/${lo}¬∞F üåßÔ∏è ${rain} ‚ùÑÔ∏è ${snow} üí® ${wind} mph ‚òî ${pop}%`;
    container.appendChild(dayDiv);
  }

  startTileSlider("forecastSlider", CONFIG.rotateIntervalMs);
}

function rotateForecastView(){
  if(pauseStates.forecast) return;
  if(forecastData.time){
    forecastViewIndex=(forecastViewIndex+1)%forecastViews.length;
    renderForecast();
  }
}

setInterval(rotateForecastView,CONFIG.rotateIntervalMs);

/* ========== MOON PHASE ========== */
function calculateMoonPhase(date){
  let year=date.getFullYear();
  let month=date.getMonth()+1;
  const day=date.getDate();
  
  let c,e,jd,b;
  if(month<3){
    year--;
    month+=12;
  }
  ++month;
  c=365.25*year;
  e=30.6*month;
  jd=c+e+day-694039.09;
  jd/=29.5305882;
  b=parseInt(jd);
  jd-=b;
  b=Math.round(jd*8);
  
  const phases=[
    {name:"New Moon",emoji:"üåë",index:0},
    {name:"Waxing Crescent",emoji:"üåí",index:1},
    {name:"First Quarter",emoji:"üåì",index:2},
    {name:"Waxing Gibbous",emoji:"üåî",index:3},
    {name:"Full Moon",emoji:"üåï",index:4},
    {name:"Waning Gibbous",emoji:"üåñ",index:5},
    {name:"Last Quarter",emoji:"üåó",index:6},
    {name:"Waning Crescent",emoji:"üåò",index:7}
  ];
  
  const phase=phases[b%8];
  const illumination=(jd*100).toFixed(1);
  return {phase,illumination,phaseIndex:b%8};
}

function findFullMoonDates(){
  const now=new Date();
  const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
  
  // Search backwards for last full moon (up to 30 days)
  let lastFull=null;
  for(let i=0;i<=30;i++){
    const testDate=new Date(today);
    testDate.setDate(testDate.getDate()-i);
    const moonData=calculateMoonPhase(testDate);
    if(moonData.phaseIndex===4){
      lastFull=testDate;
      break;
    }
  }
  
  // Search forwards for next full moon (up to 30 days)
  let nextFull=null;
  for(let i=1;i<=30;i++){
    const testDate=new Date(today);
    testDate.setDate(testDate.getDate()+i);
    const moonData=calculateMoonPhase(testDate);
    if(moonData.phaseIndex===4){
      nextFull=testDate;
      break;
    }
  }
  
  return {lastFull,nextFull};
}

function updateMoonDisplay(){
  const now=new Date();
  const moonData=calculateMoonPhase(now);
  const {lastFull,nextFull}=findFullMoonDates();
  
  document.getElementById("moonPhase").innerHTML=`${moonData.phase.emoji} ${moonData.phase.name} (${moonData.illumination}%)`;
  
  const lastStr=lastFull?lastFull.toLocaleDateString([],{month:'short',day:'numeric'}):"--";
  const nextStr=nextFull?nextFull.toLocaleDateString([],{month:'short',day:'numeric'}):"--";
  document.getElementById("moonDates").innerHTML=`Last Full: ${lastStr} | Next Full: ${nextStr}`;
}

updateMoonDisplay();
setInterval(updateMoonDisplay,60*60*1000); // Update every hour

/* ========== TOP 25 RANKINGS GRID ========== */
const LEAGUES={
  basketball:{name:'NCAAB',type:'rankings',url:"https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/rankings"},
  football:{name:'NCAAF',type:'rankings',url:"https://site.api.espn.com/apis/site/v2/sports/football/college-football/rankings"},
  nba:{name:'NBA',type:'standings',url:"https://site.web.api.espn.com/apis/v2/sports/basketball/nba/standings"},
  nfl:{name:'NFL',type:'standings',url:"https://site.web.api.espn.com/apis/v2/sports/football/nfl/standings"},
  nhl:{name:'NHL',type:'standings',url:"https://site.web.api.espn.com/apis/v2/sports/hockey/nhl/standings"},
  mlb:{name:'MLB',type:'standings',url:"https://site.web.api.espn.com/apis/v2/sports/baseball/mlb/standings"}
};

let funCurrentKey='basketball';
let funLeagueKeys=Object.keys(LEAGUES);
let funLeagueIndex=0;

async function funFetchData(){
  try{
    const response=await fetch(LEAGUES[funCurrentKey].url);
    if(!response.ok) throw new Error('Network response not ok');
    const data=await response.json();
    
    let teamList=[];

    if(LEAGUES[funCurrentKey].type==='rankings'){
      const poll=data.rankings?.find(p=>p.shortName==='AP' || p.name?.includes('Associated Press'))||data.rankings?.[0];
      if(poll && poll.ranks){
        teamList=poll.ranks.map(r=>({
          rank:r.current,
          name:r.team?.location||r.team?.displayName||r.team?.shortDisplayName||"Unknown",
          short:r.team?.abbreviation||r.team?.shortDisplayName||"UNK",
          logo:r.team?.logo||(r.team?.logos?r.team.logos[0].href:null),
          record:r.recordSummary||"0-0"
        }));
      }
    }else{
      const allTeams=[];
      const findEntries=(obj)=>{
        let entries=[];
        if(obj.standings && obj.standings.entries) entries=entries.concat(obj.standings.entries);
        if(obj.children && Array.isArray(obj.children)){
          obj.children.forEach(child=>entries=entries.concat(findEntries(child)));
        }
        if(obj.entries && Array.isArray(obj.entries) && !obj.children) entries=entries.concat(obj.entries);
        return entries;
      };

      const rawEntries=findEntries(data);
      rawEntries.forEach(entry=>{
        if(!entry.team) return;
        const stats=entry.stats||[];
        
        const winPct=stats.find(s=>['winPercent','winPercentage','percentage'].includes(s.name))?.value||0;
        const points=stats.find(s=>['points','pts'].includes(s.name))?.value||0;
        
        let recordStr="0-0";
        const recordStat=stats.find(s=>['summary','record','total','overall'].includes(s.name));
        if(recordStat){
          recordStr=recordStat.displayValue||recordStat.value||"0-0";
        }

        allTeams.push({
          name:entry.team.displayName||entry.team.name||"Unknown",
          short:entry.team.abbreviation||entry.team.shortDisplayName||"UNK",
          logo:entry.team.logos?.[0]?.href,
          record:recordStr,
          winPct:winPct,
          points:points,
          sortValue:funCurrentKey==='nhl'?points:winPct
        });
      });

      allTeams.sort((a,b)=>b.sortValue-a.sortValue);
      teamList=allTeams.slice(0,25).map((t,idx)=>({...t,rank:idx+1}));
    }

    if(teamList.length===0) throw new Error('No teams found');
    funRenderGrid(teamList);
  }catch(err){
    console.error("Fetch error:",err);
    document.getElementById("funGrid").innerHTML="<div style='color:#f00;text-align:center;width:100%;height:100%;display:flex;align-items:center;justify-content:center;'>Data unavailable</div>";
  }
}

function funRenderGrid(teams){
  const grid=document.getElementById('funGrid');
  grid.innerHTML='';
  teams.forEach((team)=>{
    const card=document.createElement('div');
    card.className='ranking-card';
    const logo=team.logo||'https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png';
    
    card.innerHTML=`
      <div class="ranking-rank">${team.rank}</div>
      <img src="${logo}" onerror="this.src='https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'">
      <div class="ranking-info">
        <div class="team-abbr">${team.short}</div>
        <div class="team-record">${team.record}</div>
      </div>
    `;
    grid.appendChild(card);
  });
}

function rotateFunLeague(){
  if(pauseStates.fun) return;
  funLeagueIndex=(funLeagueIndex+1)%funLeagueKeys.length;
  funCurrentKey=funLeagueKeys[funLeagueIndex];
  funFetchData().then(()=>startTileSlider("funSlider",CONFIG.rotateIntervalMs));
}

funFetchData();
setInterval(rotateFunLeague,CONFIG.rotateIntervalMs);
setInterval(funFetchData,10*60*1000); // Refresh every 10 minutes

function startTileSlider(sliderId, interval){
  const fill=document.getElementById('globalTimerFill');
  if(!fill) return;
  fill.style.width="0%";
  const start=Date.now();
  const update=setInterval(()=>{
    const elapsed=Date.now()-start;
    const percent=Math.min(100,(elapsed/interval)*100);
    fill.style.width=percent+"%";
    if(percent>=100) clearInterval(update);
  },50);
}

/* ========== BOARD GAME GEEK TOP 25 ========== */
const BGG_TOP_25=[
  {rank:1,name:'Brass: Birmingham',image:'https://cf.geekdo-images.com/ssLVxklP7smcAuch5NbZFQ__imagepage/img/WNrXV5hXiLz1M6dEPHw-Bwc3Y4E=/fit-in/900x600/filters:no_upscale():strip_icc()/pic3505132.jpg'},
  {rank:2,name:'Ark Nova',image:'https://cf.geekdo-images.com/zxeRjiKuU_0BY-gKQFjZIQ__imagepage/img/lHl-vDRPyALGK5mzjEyVkp-_S3I=/fit-in/900x600/filters:no_upscale():strip_icc()/pic6294115.jpg'},
  {rank:3,name:'Pandemic Legacy: Season 1',image:'https://cf.geekdo-images.com/wndsKfZQcVIbKZ03nVbUJg__imagepage/img/XhpXHj0yKYXx3KeQ_63gMqLVBo8=/fit-in/900x600/filters:no_upscale():strip_icc()/pic2452841.jpg'},
  {rank:4,name:'Gloomhaven',image:'https://cf.geekdo-images.com/PrgvAVnDHJbHvFEaV1q1Iw__imagepage/img/tL-F1WhWaBUUK4DDFSX6CaL9EYk=/fit-in/900x600/filters:no_upscale():strip_icc()/pic2437871.jpg'},
  {rank:5,name:'Dune: Imperium',image:'https://cf.geekdo-images.com/TnUvRVDusVcROeDP73UC_A__imagepage/img/KHc8BHdXVfaYwVWUEPPNtqO6-Eg=/fit-in/900x600/filters:no_upscale():strip_icc()/pic5666597.jpg'},
  {rank:6,name:'Twilight Imperium 4th',image:'https://cf.geekdo-images.com/4h1QyC-jYMQzh0uaqy3a_w__imagepage/img/1z96cObVEsAfJ4A_VrAy7XBBwWw=/fit-in/900x600/filters:no_upscale():strip_icc()/pic3727516.jpg'},
  {rank:7,name:'Dune: Imperium ‚Äì Uprising',image:'https://cf.geekdo-images.com/Aj_D-5KzYgTMXn0TwOc7qA__imagepage/img/NMcNT9phwrCH3SDcQYJEPF5A63w=/fit-in/900x600/filters:no_upscale():strip_icc()/pic6718999.jpg'},
  {rank:8,name:'War of the Ring 2nd',image:'https://cf.geekdo-images.com/JMHcnvAjLHNdNxK7W7hJ1A__imagepage/img/5lVqB7xn3DG2rHj6M8lAqWzJqH8=/fit-in/900x600/filters:no_upscale():strip_icc()/pic5160037.jpg'},
  {rank:9,name:'Terraforming Mars',image:'https://cf.geekdo-images.com/oMtSjfzUlYYCnhk_OZr0dA__imagepage/img/Sm_FzQhKoX4-Trc5k7cbVuPhxhA=/fit-in/900x600/filters:no_upscale():strip_icc()/pic3398571.jpg'},
  {rank:10,name:'Star Wars: Rebellion',image:'https://cf.geekdo-images.com/_nHjbpKlGjCqEgbJtBzHsw__imagepage/img/EVKEeI5F2bBELq0-OFG7LE7Bvkk=/fit-in/900x600/filters:no_upscale():strip_icc()/pic2396598.jpg'},
  {rank:11,name:'Agricola',image:'https://cf.geekdo-images.com/F0hlyKnx5s0humaQysM9zA__imagepage/img/Oy3ggbXWdUnlHxV-5X0vWxZg-_E=/fit-in/900x600/filters:no_upscale():strip_icc()/pic5123242.jpg'},
  {rank:12,name:'Dominion',image:'https://cf.geekdo-images.com/iw7jLOq07Yd5Gte1d3VQOA__imagepage/img/hBNqiCQXYTGNNgV_8s-HCfJSKTw=/fit-in/900x600/filters:no_upscale():strip_icc()/pic4697900.jpg'},
  {rank:13,name:'7 Wonders',image:'https://cf.geekdo-images.com/B0F4snJHZHhg8uHVknDViA__imagepage/img/0tPOvlqNH-jyb8qqxT5sKLm9yEA=/fit-in/900x600/filters:no_upscale():strip_icc()/pic860217.jpg'},
  {rank:14,name:'Carcassonne',image:'https://cf.geekdo-images.com/rax5TCu77xiclqzqeHHfhw__imagepage/img/cZJbMB7pAg3kKDDEKuJ8nWGJ3J0=/fit-in/900x600/filters:no_upscale():strip_icc()/pic3122885.jpg'},
  {rank:15,name:'Power Grid',image:'https://cf.geekdo-images.com/B0i2eV3lzDSIJcYLtKjTeA__imagepage/img/nCSrGmZEAx9-L8E2HVGmJSN9JQE=/fit-in/900x600/filters:no_upscale():strip_icc()/pic5155124.jpg'},
  {rank:16,name:'Innovation',image:'https://cf.geekdo-images.com/Vz4aXNyf3mXR9qATMx0J0A__imagepage/img/AkzrVCSp0uXmXt2hG4BxQaZmQ8w=/fit-in/900x600/filters:no_upscale():strip_icc()/pic1532154.jpg'},
  {rank:17,name:'Ticket to Ride',image:'https://cf.geekdo-images.com/A5rMG_yM_b-OMkM1tnnYbA__imagepage/img/9wQxBQaHp9IZGNBxiUzLeELt-T4=/fit-in/900x600/filters:no_upscale():strip_icc()/pic5900549.jpg'},
  {rank:18,name:'Codenames',image:'https://cf.geekdo-images.com/D5VgarmHCd0SS03x4SHBYg__imagepage/img/w4VZQ4rKwP8CVJ3XnP08ZPwqg8Y=/fit-in/900x600/filters:no_upscale():strip_icc()/pic2582706.jpg'},
  {rank:19,name:'Puerto Rico',image:'https://cf.geekdo-images.com/i3tB6KREKSmCGJEWyaVHJA__imagepage/img/EH3JiCqWWJL6pNQdGkQFCwfm-3o=/fit-in/900x600/filters:no_upscale():strip_icc()/pic1407726.jpg'},
  {rank:20,name:'Food Chain Magnate',image:'https://cf.geekdo-images.com/EYdCLvH0mD_N7-g5OLqELg__imagepage/img/Q0-5C6QLs4xXqwLGhgxVt71nfLc=/fit-in/900x600/filters:no_upscale():strip_icc()/pic5316558.jpg'},
  {rank:21,name:'Splendor',image:'https://cf.geekdo-images.com/w6yKE37jZN7UjDHrDGr8Sw__imagepage/img/9H2_Yk6vX8Y3x3rJHYPQZz5h34g=/fit-in/900x600/filters:no_upscale():strip_icc()/pic2449179.jpg'},
  {rank:22,name:'Imperial 2030',image:'https://cf.geekdo-images.com/UgGWzVBGP8N6JV3SUdDL0Q__imagepage/img/XJk1G0qTDGJcM2GCo-EE8fKIzG8=/fit-in/900x600/filters:no_upscale():strip_icc()/pic414216.jpg'},
  {rank:23,name:'The Castles of Burgundy',image:'https://cf.geekdo-images.com/RTx1E6BvzTEf8umdBUjXiA__imagepage/img/vFSg3lcMqHwNh9xpPHM5IYqjPt0=/fit-in/900x600/filters:no_upscale():strip_icc()/pic3785264.jpg'},
  {rank:24,name:'Twilight Struggle',image:'https://cf.geekdo-images.com/I0-SEWmakM-8SmT0ZrDnzQ__imagepage/img/RIqqGnvA3I7xKf1J8mfWEz-_B0I=/fit-in/900x600/filters:no_upscale():strip_icc()/pic486635.jpg'},
  {rank:25,name:'Azul',image:'https://cf.geekdo-images.com/aPjyaLg_CiHfQEwlqXJ4nA__imagepage/img/p_RgRZJHNcSDh7cYMm1a9j-sZ6w=/fit-in/900x600/filters:no_upscale():strip_icc()/pic3718275.jpg'}
];

let bggIndex=0;

function renderBGGGrid(){
  const grid=document.getElementById('bggGrid');
  grid.innerHTML='';
  BGG_TOP_25.forEach((game)=>{
    const card=document.createElement('div');
    card.className='bgg-card';
    
    card.innerHTML=`
      <div class="bgg-rank">${game.rank}</div>
      <img src="${game.image}" onerror="this.src='https://via.placeholder.com/300x300?text=BGG'" alt="${game.name}">
      <div class="bgg-info">${game.name}</div>
    `;
    grid.appendChild(card);
  });
}

function rotateBGGTile(){
  if(pauseStates.bgg) return;
  renderBGGGrid();
  startTileSlider("bggSlider",CONFIG.rotateIntervalMs);
}

renderBGGGrid();
setInterval(rotateBGGTile,CONFIG.rotateIntervalMs);

/* ========== SPORTS TEAM SCHEDULE ========== */
const SPORTS_TEAMS=[
  {id:'nuggets',name:'Nuggets',league:'nba',sport:'basketball',espnId:'den',icon:'üèÄ',color:'#0E2240'},
  {id:'broncos',name:'Broncos',league:'nfl',sport:'football',espnId:'den',icon:'üèà',color:'#FB4F14'},
  {id:'avalanche',name:'Avalanche',league:'nhl',sport:'hockey',espnId:'col',icon:'üèí',color:'#6F263D'},
  {id:'rockies',name:'Rockies',league:'mlb',sport:'baseball',espnId:'col',icon:'‚öæ',color:'#333366'}
];

let sportsTeamIndex=0;
let currentSportsTeam=SPORTS_TEAMS[0];
let sportsScheduleData={};

async function loadTeamSchedule(team){
  try{
    const url=`https://site.api.espn.com/apis/site/v2/sports/${team.sport}/${team.league}/teams/${team.espnId}/schedule`;
    const response=await fetch(url);
    if(!response.ok) throw new Error('Network response not ok');
    const data=await response.json();
    
    if(data.events){
      const now=new Date();
      const teamEvents=data.events.filter(event=>{
        const competitors=event.competitions[0].competitors;
        return competitors.some(c=>
          String(c.id).toLowerCase()===String(team.espnId).toLowerCase()||
          String(c.team?.abbreviation).toLowerCase()===String(team.espnId).toLowerCase()
        );
      });
      
      const sorted=[...teamEvents].sort((a,b)=>new Date(a.date)-new Date(b.date));
      
      const completed=sorted.filter(e=>
        e.competitions[0].status.type.completed===true||
        (new Date(e.date)<now && e.competitions[0].status.type.state==='post')
      );
      const lastGame=completed.length>0?completed[completed.length-1]:null;
      
      const upcoming=sorted.filter(e=>
        e.competitions[0].status.type.state==='pre'&&
        new Date(e.date)>=now
      ).slice(0,3);
      
      sportsScheduleData[team.id]={last:lastGame,upcoming:upcoming};
    }
  }catch(err){
    console.error("Team schedule error:",err);
    sportsScheduleData[team.id]={last:null,upcoming:[]};
  }
}

function renderSportsTeam(team){
  const schedule=sportsScheduleData[team.id]||{last:null,upcoming:[]};
  let html=`
    <div class="sports-team-header">
      <div class="sports-team-icon">${team.icon}</div>
      <div>
        <div class="sports-team-name">${team.name}</div>
        <div class="sports-team-league">${team.sport}</div>
      </div>
    </div>
    <div class="sports-games-container">
  `;
  
  if(schedule.last){
    const comp=schedule.last.competitions[0];
    const home=comp.competitors.find(c=>c.homeAway==='home');
    const away=comp.competitors.find(c=>c.homeAway==='away');
    const myTeam=comp.competitors.find(c=>String(c.id).toLowerCase()===String(team.espnId).toLowerCase()||String(c.team?.abbreviation).toLowerCase()===String(team.espnId).toLowerCase());
    const isWin=myTeam?.winner;
    const homeScore=home.score?.displayValue||home.score?.value||'0';
    const awayScore=away.score?.displayValue||away.score?.value||'0';
    const gameDate=new Date(schedule.last.date).toLocaleDateString([],{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'});
    
    html+=`
      <div class="sports-game-card">
        <div class="sports-game-status sports-game-final">FINAL</div>
        <div class="sports-game-team">
          <img src="${away.team.logos?.[0]?.href||'https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'}" class="sports-game-logo" onerror="this.src='https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'">
          <div class="sports-game-abbr">${away.team.abbreviation}</div>
          <div class="sports-game-score">${awayScore}</div>
        </div>
        <div class="sports-game-vs">
          <div class="sports-game-date">${gameDate}</div>
          <div class="sports-game-result ${isWin?'sports-game-win':'sports-game-loss'}">${isWin?'W':'L'}</div>
        </div>
        <div class="sports-game-team">
          <img src="${home.team.logos?.[0]?.href||'https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'}" class="sports-game-logo" onerror="this.src='https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'">
          <div class="sports-game-abbr">${home.team.abbreviation}</div>
          <div class="sports-game-score">${homeScore}</div>
        </div>
      </div>
    `;
  }
  
  schedule.upcoming.forEach((game,idx)=>{
    const comp=game.competitions[0];
    const home=comp.competitors.find(c=>c.homeAway==='home');
    const away=comp.competitors.find(c=>c.homeAway==='away');
    const gameDate=new Date(game.date).toLocaleDateString([],{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'});
    
    html+=`
      <div class="sports-game-card">
        <div class="sports-game-status">Next ${idx+1}</div>
        <div class="sports-game-team">
          <img src="${away.team.logos?.[0]?.href||'https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'}" class="sports-game-logo" onerror="this.src='https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'">
          <div class="sports-game-abbr">${away.team.abbreviation}</div>
        </div>
        <div class="sports-game-vs">
          <div class="sports-game-date">${gameDate}</div>
        </div>
        <div class="sports-game-team">
          <img src="${home.team.logos?.[0]?.href||'https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'}" class="sports-game-logo" onerror="this.src='https://a.espncdn.com/combiner/i?img=/i/teamlogos/default-team-logo-500.png'">
          <div class="sports-game-abbr">${home.team.abbreviation}</div>
        </div>
      </div>
    `;
  });
  
  html+='</div>';
  document.getElementById('sportsContent').innerHTML=html;
}

async function rotateSportsTeam(){
  if(pauseStates.sports) return;
  sportsTeamIndex=(sportsTeamIndex+1)%SPORTS_TEAMS.length;
  currentSportsTeam=SPORTS_TEAMS[sportsTeamIndex];
  await loadTeamSchedule(currentSportsTeam);
  renderSportsTeam(currentSportsTeam);
  startTileSlider('sportsSlider',CONFIG.rotateIntervalMs);
}

async function initSportsTeams(){
  for(const team of SPORTS_TEAMS){
    await loadTeamSchedule(team);
  }
  renderSportsTeam(currentSportsTeam);
}

initSportsTeams();
setInterval(rotateSportsTeam,CONFIG.rotateIntervalMs);
setInterval(()=>{
  for(const team of SPORTS_TEAMS){
    loadTeamSchedule(team);
  }
},10*60*1000); // Refresh every 10 minutes


</script>
</body>
</html>

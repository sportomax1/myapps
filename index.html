<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tile Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;}
body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial,Helvetica,sans-serif;
  height:100vh;
  display:grid;
  grid-template-rows:1fr 1fr;
  grid-template-columns:repeat(4,1fr);
  gap:1vh;
  padding:1vh;
  overflow:hidden;
}

/* TILE STYLE */
.tile{
  background:#111;
  border-radius:1vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1vh;
  overflow:hidden;
  position:relative;
}

/* CLOCK */
#clock{font-size:5vw;font-weight:bold;text-align:center;}
body.pulse #clock{font-size:8vw;transition:font-size 0.3s;}

/* INTERNET SPEED */
#speed{font-size:1.5vw;text-align:center;}

/* CALENDAR */
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:0.3vh;width:90%;}
.calendar-day{opacity:0.6;font-weight:bold;text-align:center;}
.calendar-date{padding:0.5vh 0;border-radius:50%;display:flex;justify-content:center;align-items:center;}
.today{background:white;color:black;font-weight:bold;}

/* FORECAST */
#forecast{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:0.3vh;}
.forecast-day{background:#222;margin:0.3vh;padding:0.5vh 0.5vw;width:90%;border-radius:0.5vh;text-align:center;}

/* ROTATING TILE SLIDER */
.tile-slider{width:90%;height:0.3vh;background:#555;border-radius:0.2vh;margin-top:0.5vh;position:relative;}
.tile-slider-fill{background:#0f0;height:100%;width:0%;border-radius:0.2vh;transition:width 0.1s linear;}

/* BGG LIST */
#bggList{text-align:left;width:90%;overflow:auto;}

/* RESPONSIVE */
@media(max-width:1024px){
  #clock{font-size:8vw;}
  #speed{font-size:2vw;}
}
</style>
</head>
<body>

<!-- Top row tiles -->
<div class="tile" id="tileClock"><div id="clock">--:--:--</div></div>
<div class="tile" id="tileSpeed"><div id="speed">Testing speed...</div></div>
<div class="tile" id="tileWeather"><div id="weather">Loading weather‚Ä¶</div></div>
<div class="tile" id="tileForecast"><div id="forecast">Loading forecast‚Ä¶</div><div class="tile-slider"><div class="tile-slider-fill" id="forecastSlider"></div></div></div>

<!-- Bottom row tiles -->
<div class="tile" id="tileCalendar"><div id="calendar"></div></div>
<div class="tile" id="tileBGG">
  <div id="bggList">Loading Top 10 BGG‚Ä¶</div>
</div>
<div class="tile" id="tileFun">
  <div id="funText">Loading fun tile‚Ä¶</div>
  <div class="tile-slider"><div class="tile-slider-fill" id="funSlider"></div></div>
</div>
<div class="tile" id="tilePlaceholder">Placeholder Tile</div>

<script>
/* ========== CONFIG ========== */
const CONFIG={rotateIntervalMs:5000, location:{lat:39.5186,lon:-104.7614}};

/* ========== CLOCK ========== */
function updateClock(){
  const now=new Date();
  document.getElementById("clock").textContent=now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  if(now.getSeconds()===0){
    document.body.classList.add("pulse");
    setTimeout(()=>document.body.classList.remove("pulse"),1000);
  }
}
setInterval(updateClock,1000);
updateClock();

/* ========== INTERNET SPEED ========== */
async function testSpeed(){
  const speedDiv=document.getElementById("speed");
  try{
    const start=performance.now();
    const fileSize=500000;
    const url="https://cors-anywhere.herokuapp.com/https://speed.hetzner.de/100MB.bin";
    const res=await fetch(url,{method:'GET',cache:'no-cache'});
    const data=await res.blob();
    const duration=(performance.now()-start)/1000;
    const bits=fileSize*8;
    const Mbps=(bits/duration/1000000).toFixed(1);
    speedDiv.textContent=`‚¨á ${Mbps} Mbps`;
  }catch{speedDiv.textContent="Speed unavailable";}
}
testSpeed(); setInterval(testSpeed,60000);

/* ========== CALENDAR ========== */
function renderCalendar(){
  const now=new Date();
  const year=now.getFullYear(), month=now.getMonth(), today=now.getDate();
  const firstDay=new Date(year,month,1).getDay();
  const daysInMonth=new Date(year,month+1,0).getDate();

  let html="";
  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>html+=`<div class="calendar-day">${d}</div>`);
  for(let i=0;i<firstDay;i++) html+="<div></div>";
  for(let d=1;d<=daysInMonth;d++){
    const cls=d===today?"calendar-date today":"calendar-date";
    html+=`<div class="${cls}">${d}</div>`;
  }
  document.getElementById("calendar").innerHTML=html;
}
renderCalendar();

/* ========== WEATHER ========== */
let forecastData=[];
async function loadWeather(){
  try{
    const {lat,lon}=CONFIG.location;
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`+
      `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,rain_sum,snowfall_sum,windspeed_10m_max,precipitation_probability_max,sunrise,sunset,weathercode`+
      `&current_weather=true&timezone=auto&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch`;
    const res=await fetch(url); const d=await res.json();

    // Weather summary
    const cw=d.current_weather;
    document.getElementById("weather").textContent=`üå°Ô∏è ${Math.round(cw.temperature)}¬∞F üí® ${Math.round(cw.windspeed)} mph`;

    forecastData=d.daily;
    renderForecast();
  }catch{document.getElementById("weather").textContent="Weather unavailable";}
}
loadWeather();
setInterval(loadWeather,30*60*1000);

function getWeatherIcon(code){if(code===0)return"‚òÄÔ∏è";else if(code<=3)return"‚õÖ";else if(code>=61 && code<=63)return"üåßÔ∏è";else if(code>=71 && code<=73)return"‚ùÑÔ∏è";else return"‚òÅÔ∏è";}

function renderForecast(){
  const container=document.getElementById("forecast"); container.innerHTML="";
  forecastData.time.forEach((t,i)=>{
    const date=new Date(t); const day=date.toLocaleDateString([], {weekday:'short'});
    const hi=Math.round(forecastData.temperature_2m_max[i]);
    const lo=Math.round(forecastData.temperature_2m_min[i]);
    const rain=forecastData.rain_sum[i].toFixed(2); const snow=forecastData.snowfall_sum[i].toFixed(2);
    const wind=Math.round(forecastData.windspeed_10m_max[i]); const pop=forecastData.precipitation_probability_max[i];
    const sunrise=new Date(forecastData.sunrise[i]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const sunset=new Date(forecastData.sunset[i]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const icon=getWeatherIcon(forecastData.weathercode[i]);

    const dayDiv=document.createElement("div"); dayDiv.className="forecast-day";
    dayDiv.innerHTML=`${day} ${icon} üå°Ô∏è ${hi}/${lo}¬∞F üåßÔ∏è ${rain} ‚ùÑÔ∏è ${snow} üí® ${wind} mph ‚òî ${pop}% üåÖ ${sunrise} üåá ${sunset}`;
    container.appendChild(dayDiv);
  });

  // Auto-rotate if too many days
  startTileSlider("forecastSlider", CONFIG.rotateIntervalMs);
}

/* ========== ROTATING TILES ========== */
const funTiles=["Quote 1","Quote 2","Quote 3","Quote 4"];
let funIndex=0;
function rotateFunTile(){
  document.getElementById("funText").textContent=funTiles[funIndex];
  funIndex=(funIndex+1)%funTiles.length;
  startTileSlider("funSlider", CONFIG.rotateIntervalMs);
}
rotateFunTile(); setInterval(rotateFunTile, CONFIG.rotateIntervalMs);

function startTileSlider(sliderId, interval){
  const fill=document.getElementById(sliderId);
  fill.style.width="0%";
  const start=Date.now();
  const update=setInterval(()=>{
    const elapsed=Date.now()-start;
    const percent=Math.min(100,(elapsed/interval)*100);
    fill.style.width=percent+"%";
    if(percent>=100) clearInterval(update);
  },50);
}

/* ========== BOARD GAME GEEK TOP 10 ========== */
const bggTop10=[
  "1. Brass: Birmingham","2. Ark Nova","3. Pandemic Legacy: Season 1","4. Gloomhaven",
  "5. Dune: Imperium","6. Twilight Imperium 4th","7. Dune: Imperium ‚Äì Uprising",
  "8. War of the Ring 2nd","9. Terraforming Mars","10. Star Wars: Rebellion"
];
document.getElementById("bggList").innerHTML=bggTop10.join("<br>");

</script>
</body>
</html>
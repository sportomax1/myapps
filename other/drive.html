<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parker to Lakewood Drive</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --accent: #007aff;
            --bg: #f5f5f7;
            --panel-bg: rgba(255, 255, 255, 0.9);
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, system-ui, sans-serif; background: var(--bg); overflow: hidden; }
        #map { height: 100vh; width: 100%; }
        
        .control-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .stats {
            display: flex;
            justify-content: space-between;
            text-align: center;
        }
        .stat-item { flex: 1; }
        .stat-label { font-size: 10px; text-transform: uppercase; color: #86868b; font-weight: 600; letter-spacing: 0.5px; }
        .stat-value { font-size: 18px; font-weight: 700; color: #1d1d1f; }

        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(0,0,0,0.05);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background: var(--accent);
            transition: width 0.1s linear;
        }

        .btn-start {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-start:active { transform: scale(0.98); opacity: 0.9; }
        .btn-start:disabled { background: #d2d2d7; cursor: not-allowed; }

        .location-badge {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>

    <div class="location-badge" id="currentLoc">Parker âž” Lakewood</div>
    
    <div id="map"></div>

    <div class="control-panel">
        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">Distance</div>
                <div class="stat-value" id="distVal">-- mi</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Time</div>
                <div class="stat-value" id="timeVal">-- min</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Speed</div>
                <div class="stat-value" id="speedVal">0 mph</div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <button class="btn-start" id="startBtn">Start Drive</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Coordinates
        const parker = [39.5186, -104.7614];
        const lakewood = [39.7047, -105.0814];

        // Initialize Map
        const map = L.map('map', {
            zoomControl: false
        }).setView(parker, 11);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // Custom Car Marker
        const carIcon = L.divIcon({
            html: `<div style="font-size: 24px; transform: rotate(90deg); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3))">ðŸš—</div>`,
            className: 'car-icon',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });

        let marker = L.marker(parker, { icon: carIcon }).addTo(map);
        let routeLine;
        let routeCoords = [];
        let animationFrame;
        let isDriving = false;
        let currentIndex = 0;

        // Fetch Route from OSRM
        async function getRoute() {
            const url = `https://router.project-osrm.org/route/v1/driving/${parker[1]},${parker[0]};${lakewood[1]},${lakewood[0]}?overview=full&geometries=geojson`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                const route = data.routes[0];
                
                routeCoords = route.geometry.coordinates.map(coord => [coord[1], coord[0]]);
                
                // Draw route line
                if (routeLine) map.removeLayer(routeLine);
                routeLine = L.polyline(routeCoords, {
                    color: '#007aff',
                    weight: 5,
                    opacity: 0.6,
                    lineJoin: 'round'
                }).addTo(map);

                // Update Stats
                document.getElementById('distVal').innerText = (route.distance / 1609.34).toFixed(1) + ' mi';
                document.getElementById('timeVal').innerText = Math.round(route.duration / 60) + ' min';
                
                // Fit bounds
                map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
            } catch (error) {
                console.error("Routing error:", error);
            }
        }

        function animate() {
            if (!isDriving || currentIndex >= routeCoords.length) {
                isDriving = false;
                document.getElementById('startBtn').innerText = 'Reset Drive';
                document.getElementById('speedVal').innerText = '0 mph';
                return;
            }

            const current = routeCoords[currentIndex];
            const next = routeCoords[currentIndex + 1];

            marker.setLatLng(current);
            map.panTo(current, { animate: true, duration: 0.1 });

            // Calculate rotation
            if (next) {
                const angle = Math.atan2(next[0] - current[0], next[1] - current[1]) * 180 / Math.PI;
                marker.getElement().style.transform += ` rotate(${90 - angle}deg)`;
            }

            // Update Progress
            const progress = (currentIndex / routeCoords.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('speedVal').innerText = '65 mph';

            currentIndex++;
            animationFrame = setTimeout(() => requestAnimationFrame(animate), 50);
        }

        document.getElementById('startBtn').onclick = () => {
            if (currentIndex >= routeCoords.length) {
                // Reset
                currentIndex = 0;
                marker.setLatLng(parker);
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('startBtn').innerText = 'Start Drive';
                map.setView(parker, 11);
                return;
            }

            if (!isDriving) {
                isDriving = true;
                document.getElementById('startBtn').innerText = 'Pause';
                animate();
            } else {
                isDriving = false;
                document.getElementById('startBtn').innerText = 'Resume';
                clearTimeout(animationFrame);
            }
        };

        // Initialize
        getRoute();

    </script>
</body>
</html>
